# 概念与术语

本页用于解释 Bastion 与 Web UI 中的核心概念，便于你快速建立正确的“心智模型”。

## Hub、客户端与节点

- **Hub**：Bastion 主服务（HTTP API + Web UI + 调度/队列）。在 UI 和 API 中，Hub 使用特殊的节点 ID：`hub`。
- **客户端（Agent）**（可选）：远端执行节点，通过 WebSocket 连接到 Hub，在另一台机器上执行备份任务。
- **节点（Node）**：泛指 Hub 或某个客户端。一个任务只会在 **一个** 节点上执行。

## 备份任务、运行与快照

- **备份任务（Job）**：一次备份的配置（数据源 + 目标 + 计划 + 保留策略 + 通知）。
- **运行（Run）**：任务的一次执行（queued → running → success/failed/rejected）。运行有事件/日志，也可能产出备份数据。
- **快照（Snapshot）**：一次成功运行产出的“已存储备份数据”（以及 Hub 中的索引记录）。
  - 快照是你在 UI 里固定/删除/执行保留策略的对象。
  - 快照与运行分离：这样即使旧运行记录被清理，备份数据仍然可以继续管理。

## 操作（恢复 / 校验）

**操作（Operation）** 是从成功的运行发起的长耗时动作：

- **Restore（恢复）**：将快照中的全部或部分文件恢复到指定目的地（本地目录或 WebDAV）。
- **Verify（校验）**：恢复到临时目录并做哈希校验（适用时也会做 SQLite 完整性检查）。

操作有独立的进度与事件日志，会显示在运行详情页中。

## Secrets（凭据）

Bastion 将凭据以 **加密 secret** 的形式存储在 Hub 数据库中。

- **按节点隔离（node-scoped）**（重要）：很多凭据是按节点隔离的（Hub vs 每个客户端）。
  - 例：WebDAV 凭据必须存在于“实际执行 WebDAV 上传/下载”的节点上。
  - 需要时可用批量操作把 Hub 的凭据分发到客户端。

## Bulk operations（批量操作）

**批量操作** 是对多个客户端异步执行的动作（例如：批量加/删标签、同步配置、分发 WebDAV 凭据、部署任务）。

- 每个批量操作会包含按客户端划分的 **items**（每个 item 有自己的状态与错误信息）。
