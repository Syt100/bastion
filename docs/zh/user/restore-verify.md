# 恢复与校验（Restore / Verify）

恢复与校验都是从 **成功的运行** 发起的长耗时 **操作**。

## 发起操作

在 Web UI：

1. 打开某个任务的 **运行记录**，选择一个 **成功** 的运行
2. 点击 **恢复** 或 **校验**

操作会显示在运行详情页中（状态 + 进度 + 事件日志）。

## Restore（恢复）

恢复会读取快照，并把文件写入到你选择的目的地。

### 目的地类型

#### 本地文件系统（Local filesystem）

- **节点**：在哪个节点上执行恢复（Hub 或某个客户端）
- **目标目录**：该节点上的目标目录

说明：

- 目录路径在所选节点的文件系统中解释。
- **浏览** 需要所选节点在线。

#### WebDAV

- **WebDAV 地址**：例如 `https://dav.example.com/backup-restore`
- **WebDAV 凭据**：选择 WebDAV 凭据名
- **目标前缀**：WebDAV 地址下的目标子目录

重要：

- WebDAV 凭据是 **按节点隔离** 的。只有当“执行恢复的节点”具备对应 WebDAV 凭据时，恢复才能成功。

见：[存储（WebDAV）](/zh/user/storage)。

### 冲突策略（Conflict policy）

当目的地已存在同名路径时：

- **overwrite**：覆盖已有文件
- **skip**：保留已有文件，跳过冲突项
- **fail**：遇到第一处冲突即失败退出

### 选择性恢复（可选）

你可以：

- 默认恢复全部内容，或
- 仅从条目列表中选择部分文件/目录恢复

## Verify（校验）

校验是一套基于恢复的完整性检查流程：

1. 拉取快照
2. 恢复到一个 **临时目录**
3. 按快照索引做文件哈希校验
4. 适用时对 SQLite 文件做完整性检查

如果校验失败，操作会标记为 **failed**，事件日志会包含部分示例错误。

## 多节点注意事项与当前限制

- **加密备份 + 恢复到客户端**：当你把加密备份恢复到客户端时，Hub 会在派发恢复前自动确保该客户端具备所需私钥。
- **校验当前在 Hub 上执行**。这意味着：
  - WebDAV 目标的快照：只要 Hub 有对应 WebDAV 凭据，就可以校验。
  - 客户端上的本地目录快照：通常 **无法** 在 Hub 上校验（除非 Hub 能访问到该目录，例如共享挂载）。

如果你在多节点部署中非常依赖 Hub 侧的校验，建议优先使用 **WebDAV** 作为备份目标。
